<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/auth/login" text=""></ion-back-button>
    </ion-buttons>
    <ion-title>Crear Cuenta</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="auth-background" fullscreen>
  <div class="mx-auto max-w-sm px-6 py-8">

    <div class="mb-6 text-center">
      <p class="text-sm text-gray-500">Completa tus datos para registrarte</p>
    </div>

    <!-- Card -->
    <div class="rounded-2xl bg-white p-6 shadow-xl">

      <!-- Error message -->
      @if (errorMessage()) {
        <div class="mb-4 rounded-lg bg-red-50 p-3">
          <ion-text color="danger">
            <p class="text-sm">{{ errorMessage() }}</p>
          </ion-text>
        </div>
      }

      <form [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>

        <!-- Nombre -->
        <div class="mb-3">
          <ion-item lines="full" [class.ion-invalid]="hasError('primerNombre', 'required')">
            <ion-icon name="person-outline" slot="start" color="medium"></ion-icon>
            <ion-label position="floating">Primer nombre *</ion-label>
            <ion-input
              type="text"
              formControlName="primerNombre"
              autocomplete="given-name"
            ></ion-input>
          </ion-item>
          @if (hasError('primerNombre', 'required')) {
            <p class="error-message">El nombre es requerido.</p>
          }
        </div>

        <!-- Apellido -->
        <div class="mb-3">
          <ion-item lines="full" [class.ion-invalid]="hasError('primerApellido', 'required')">
            <ion-icon name="person-outline" slot="start" color="medium"></ion-icon>
            <ion-label position="floating">Primer apellido *</ion-label>
            <ion-input
              type="text"
              formControlName="primerApellido"
              autocomplete="family-name"
            ></ion-input>
          </ion-item>
          @if (hasError('primerApellido', 'required')) {
            <p class="error-message">El apellido es requerido.</p>
          }
        </div>

        <!-- Tipo Documento -->
        <div class="mb-3">
          <ion-item lines="full">
            <ion-icon name="card-outline" slot="start" color="medium"></ion-icon>
            <ion-label position="floating">Tipo de documento *</ion-label>
            <ion-select formControlName="tipoDocumento" interface="action-sheet">
              @for (opt of tipoDocumentoOptions; track opt.value) {
                <ion-select-option [value]="opt.value">{{ opt.label }}</ion-select-option>
              }
            </ion-select>
          </ion-item>
        </div>

        <!-- Documento -->
        <div class="mb-3">
          <ion-item lines="full" [class.ion-invalid]="hasError('documento', 'required')">
            <ion-icon name="card-outline" slot="start" color="medium"></ion-icon>
            <ion-label position="floating">Número de documento *</ion-label>
            <ion-input
              type="text"
              formControlName="documento"
              inputmode="numeric"
            ></ion-input>
          </ion-item>
          @if (hasError('documento', 'required')) {
            <p class="error-message">El documento es requerido.</p>
          }
        </div>

        <!-- Email -->
        <div class="mb-3">
          <ion-item lines="full" [class.ion-invalid]="f.email.touched && f.email.invalid">
            <ion-icon name="mail-outline" slot="start" color="medium"></ion-icon>
            <ion-label position="floating">Correo electrónico *</ion-label>
            <ion-input
              type="email"
              formControlName="email"
              autocomplete="email"
              inputmode="email"
            ></ion-input>
          </ion-item>
          @if (hasError('email', 'required')) {
            <p class="error-message">El correo es requerido.</p>
          }
          @if (hasError('email', 'email')) {
            <p class="error-message">Ingresa un correo válido.</p>
          }
        </div>

        <!-- Teléfono (opcional) -->
        <div class="mb-3">
          <ion-item lines="full">
            <ion-icon name="call-outline" slot="start" color="medium"></ion-icon>
            <ion-label position="floating">Teléfono (opcional)</ion-label>
            <ion-input
              type="tel"
              formControlName="telefono"
              autocomplete="tel"
              inputmode="tel"
            ></ion-input>
          </ion-item>
        </div>

        <!-- Password -->
        <div class="mb-3">
          <ion-item lines="full" [class.ion-invalid]="f.password.touched && f.password.invalid">
            <ion-icon name="lock-closed-outline" slot="start" color="medium"></ion-icon>
            <ion-label position="floating">Contraseña *</ion-label>
            <ion-input
              [type]="showPassword() ? 'text' : 'password'"
              formControlName="password"
              autocomplete="new-password"
            ></ion-input>
            <ion-button fill="clear" slot="end" (click)="togglePassword()" type="button">
              <ion-icon [name]="showPassword() ? 'eye-off-outline' : 'eye-outline'" color="medium"></ion-icon>
            </ion-button>
          </ion-item>
          @if (hasError('password', 'required')) {
            <p class="error-message">La contraseña es requerida.</p>
          }
          @if (hasError('password', 'minlength')) {
            <p class="error-message">Mínimo 8 caracteres.</p>
          }
        </div>

        <!-- Confirmar Password -->
        <div class="mb-6">
          <ion-item lines="full" [class.ion-invalid]="f.confirmarPassword.touched && (f.confirmarPassword.invalid || form.hasError('passwordMismatch'))">
            <ion-icon name="lock-closed-outline" slot="start" color="medium"></ion-icon>
            <ion-label position="floating">Confirmar contraseña *</ion-label>
            <ion-input
              [type]="showPassword() ? 'text' : 'password'"
              formControlName="confirmarPassword"
              autocomplete="new-password"
            ></ion-input>
          </ion-item>
          @if (f.confirmarPassword.touched && form.hasError('passwordMismatch')) {
            <p class="error-message">Las contraseñas no coinciden.</p>
          }
        </div>

        <!-- Submit -->
        <ion-button
          expand="block"
          type="submit"
          [disabled]="form.invalid || loading()"
          class="mb-4"
        >
          @if (loading()) {
            <ion-spinner name="crescent" class="mr-2"></ion-spinner>
          }
          Crear Cuenta
        </ion-button>

      </form>

      <!-- Login link -->
      <p class="text-center text-sm text-gray-500">
        ¿Ya tienes cuenta?
        <a routerLink="/auth/login" class="font-semibold text-primary">
          Inicia sesión
        </a>
      </p>

    </div>
  </div>
</ion-content>
