<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/auth/login" text=""></ion-back-button>
    </ion-buttons>
    <ion-title>Recuperar Contraseña</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="mx-auto max-w-sm px-6 py-8">

    <!-- Confirmación enviada -->
    @if (sent()) {
      <div class="rounded-2xl bg-white p-6 shadow-md text-center">
        <div class="mb-4 flex justify-center">
          <div class="flex h-16 w-16 items-center justify-center rounded-full bg-green-100">
            <ion-icon name="mail-outline" class="text-3xl text-green-600"></ion-icon>
          </div>
        </div>
        <h2 class="mb-2 text-lg font-semibold text-gray-800">Revisa tu correo</h2>
        <p class="mb-6 text-sm text-gray-500 leading-relaxed">
          Si el correo está registrado, recibirás un enlace para restablecer tu contraseña.
          El enlace es válido por <strong>30 minutos</strong>.
        </p>
        <ion-button expand="block" routerLink="/auth/login" fill="outline">
          Volver al inicio de sesión
        </ion-button>
      </div>
    }

    <!-- Formulario -->
    @if (!sent()) {
      <div class="mb-6">
        <p class="text-sm text-gray-500 leading-relaxed">
          Ingresa tu correo electrónico y te enviaremos un enlace para restablecer tu contraseña.
        </p>
      </div>

      @if (errorMessage()) {
        <div class="mb-4 rounded-lg bg-red-50 p-3">
          <ion-text color="danger">
            <p class="text-sm">{{ errorMessage() }}</p>
          </ion-text>
        </div>
      }

      <div class="rounded-2xl bg-white p-6 shadow-md">
        <form [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>

          <div class="mb-6">
            <ion-item lines="full" [class.ion-invalid]="emailCtrl.invalid && emailCtrl.touched">
              <ion-icon name="mail-outline" slot="start" color="medium"></ion-icon>
              <ion-label position="floating">Correo electrónico</ion-label>
              <ion-input
                type="email"
                formControlName="email"
                autocomplete="email"
                inputmode="email"
              ></ion-input>
            </ion-item>
            @if (emailCtrl.touched && emailCtrl.hasError('required')) {
              <p class="error-message">El correo es requerido.</p>
            }
            @if (emailCtrl.touched && emailCtrl.hasError('email')) {
              <p class="error-message">Ingresa un correo válido.</p>
            }
          </div>

          <ion-button
            expand="block"
            type="submit"
            [disabled]="form.invalid || loading()"
          >
            @if (loading()) {
              <ion-spinner name="crescent" class="mr-2"></ion-spinner>
            }
            Enviar enlace
          </ion-button>

        </form>
      </div>

      <p class="mt-6 text-center text-sm text-gray-500">
        ¿Recordaste tu contraseña?
        <a routerLink="/auth/login" class="font-semibold text-primary">
          Iniciar sesión
        </a>
      </p>
    }

  </div>
</ion-content>
